{
  "address": "0xF03e98ca959843229fFca2d70aFAA42F69fBef95",
  "abi": [
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "_proofOfMatchAddress",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "_matchDataAddress",
          "type": "address"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "user",
          "type": "address"
        }
      ],
      "name": "getPresenceScore",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "matchDataContract",
      "outputs": [
        {
          "internalType": "contract IMatchData",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "proofOfMatchContract",
      "outputs": [
        {
          "internalType": "contract IProofOfMatch",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    }
  ],
  "transactionHash": "0x9119361e269057100f7ffc3490ff4355a7109936119dc1b0196ffdefe4482092",
  "receipt": {
    "to": null,
    "from": "0xf5Ac0b87325Bf1B3Eee525EB9646faFD69D2FedC",
    "contractAddress": "0xF03e98ca959843229fFca2d70aFAA42F69fBef95",
    "transactionIndex": 5,
    "gasUsed": "422311",
    "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    "blockHash": "0x2d9846552dc5f3a75acda6f6625545337aae74cfef3e00caa988b718992e6ddf",
    "transactionHash": "0x9119361e269057100f7ffc3490ff4355a7109936119dc1b0196ffdefe4482092",
    "logs": [],
    "blockNumber": 196873891,
    "cumulativeGasUsed": "1144781",
    "status": 1,
    "byzantium": true
  },
  "args": [
    "0x7a8fbD7070dF7c9495Fe00c5FBF1B118e98Fe325",
    "0xeEB8370aBE5Aa30faAc2d4be6A3C5CDC406beB75"
  ],
  "numDeployments": 2,
  "solcInputHash": "62f04855df0ec33a6e96e95d87fd5c43",
  "metadata": "{\"compiler\":{\"version\":\"0.8.24+commit.e11b9ed9\"},\"language\":\"Solidity\",\"output\":{\"abi\":[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_proofOfMatchAddress\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"_matchDataAddress\",\"type\":\"address\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"user\",\"type\":\"address\"}],\"name\":\"getPresenceScore\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"matchDataContract\",\"outputs\":[{\"internalType\":\"contract IMatchData\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"proofOfMatchContract\",\"outputs\":[{\"internalType\":\"contract IProofOfMatch\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"}],\"devdoc\":{\"author\":\"edsphinx\",\"details\":\"Serves as a Sybil resistance and on-chain reputation mechanism. It reads data from the ProofOfMatch (SBT registry) and MatchData (interaction data) contracts to generate a score based on a user's verified participation in scientific protocols.\",\"kind\":\"dev\",\"methods\":{\"constructor\":{\"details\":\"On deployment, links the addresses of the contracts this scoring module depends on.\"},\"getPresenceScore(address)\":{\"details\":\"It fetches all of the user's \\\"Proof of Protocol\\\" SBTs, gets the details for each associated interaction (including the compliance level), and applies a formula to generate the final score.\",\"params\":{\"user\":\"The address of the user (e.g., patient) to query.\"},\"returns\":{\"_0\":\"score The calculated Compliance Score.\"}}},\"title\":\"PresenceScore\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{\"getPresenceScore(address)\":{\"notice\":\"Calculates the Compliance Score for a given user address.\"},\"matchDataContract()\":{\"notice\":\"The instance of the IMatchData contract interface.\"},\"proofOfMatchContract()\":{\"notice\":\"The instance of the IProofOfMatch contract interface.\"}},\"notice\":\"Read-only contract that calculates a \\\"Compliance Score\\\" for a user (e.g., a patient).\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"contracts/Sunny/PresenceScore.sol\":\"PresenceScore\"},\"evmVersion\":\"paris\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\",\"useLiteralContent\":true},\"optimizer\":{\"enabled\":true,\"runs\":200},\"remappings\":[]},\"sources\":{\"contracts/Sunny/IMatchData.sol\":{\"content\":\"// SPDX-License-Identifier: MIT\\npragma solidity ^0.8.24;\\n\\n/**\\n * @title IInteractionData Interface\\n * @author edsphinx\\n * @dev Defines the interface for the contract that stores and manages data\\n * for on-chain scientific interactions, such as compliance levels and event counts.\\n */\\ninterface IMatchData {\\n    /**\\n     * @dev Struct that stores all information for a verified on-chain interaction.\\n     */\\n    struct Match {\\n        address userA;\\n        address userB;\\n        uint256 timestamp;\\n        string locationHint;\\n        uint8 level;\\n        uint16 interactionCount;\\n    }\\n\\n    /**\\n     * @notice Emitted when an interaction's compliance level increases.\\n     * @param matchId The ID of the interaction that was upgraded.\\n     * @param newLevel The new compliance level reached.\\n     */\\n    event MatchUpgraded(uint256 indexed matchId, uint8 newLevel);\\n\\n    /**\\n     * @notice Creates the initial data entry for a new on-chain interaction.\\n     * @dev Must only be called by the ProofOfMatch contract.\\n     * @param _matchId The unique ID of the interaction to create.\\n     * @param _userA The patient's address.\\n     * @param _userB The clinic's or institution's address.\\n     * @param _locationHint A non-sensitive hint about the interaction (e.g., \\\"Protocol Step A-1\\\").\\n     */\\n    function createMatchEntry(uint256 _matchId, address _userA, address _userB, string memory _locationHint) external;\\n\\n    /**\\n     * @notice Logs a new follow-up event for an existing interaction, potentially increasing its compliance level.\\n     * @dev Must only be called by the protocol owner (backend/oracle).\\n     * @param _matchId The ID of the interaction to update.\\n     */\\n    function recordInteraction(uint256 _matchId) external;\\n\\n    /**\\n     * @notice Gets all details for a specific on-chain interaction.\\n     * @param _matchId The ID of the interaction to query.\\n     * @return The complete Match struct with all its data.\\n     */\\n    function getMatchDetails(uint256 _matchId) external view returns (Match memory);\\n}\\n\",\"keccak256\":\"0xc7137b5cc78f552318283f1a7106a8775c6f8ccddbcfa8eb8c1150dcc7a40e4f\",\"license\":\"MIT\"},\"contracts/Sunny/IProofOfMatch.sol\":{\"content\":\"// SPDX-License-Identifier: MIT\\npragma solidity ^0.8.24;\\n\\n/**\\n * @title IProofOfMatch Interface\\n * @author edsphinx\\n * @notice Defines the public interface for the ProofOfMatch contract.\\n * @dev In the DeSci context, this contract is the core registry for \\\"Proof of Protocol\\\" SBTs.\\n * It establishes the functions and events needed for other contracts, like the Compliance Score contract,\\n * to interact with the SBT data.\\n */\\ninterface IProofOfMatch {\\n    /**\\n     * @notice Emitted when a new on-chain interaction is verified and two \\\"Proof of Protocol\\\" SBTs are minted.\\n     * @param matchId The unique ID for the on-chain interaction.\\n     * @param tokenIdA The ID of the SBT minted to the patient (userA).\\n     * @param tokenIdB The ID of the SBT minted to the clinic/institution (userB).\\n     * @param userA The address of the patient.\\n     * @param userB The address of the clinic or institution.\\n     */\\n    event MatchCreated(uint256 indexed matchId, uint256 tokenIdA, uint256 tokenIdB, address userA, address userB);\\n\\n    /**\\n     * @notice Returns the interaction ID (`matchId`) associated with a specific SBT.\\n     * @param tokenId The ID of the SBT to query.\\n     * @return The unique ID of the on-chain interaction.\\n     */\\n    function tokenToMatchId(uint256 tokenId) external view returns (uint256);\\n\\n    /**\\n     * @notice Returns an array of all \\\"Proof of Protocol\\\" SBT IDs owned by an address.\\n     * @param owner The address of the token owner (patient or clinic).\\n     * @return An array of token IDs.\\n     */\\n    function getTokensOfOwner(address owner) external view returns (uint256[] memory);\\n}\\n\",\"keccak256\":\"0xa32799813ce65afeb7e99925bb2e576975ecadf83e3bfcfe1e4bb277a31688e4\",\"license\":\"MIT\"},\"contracts/Sunny/PresenceScore.sol\":{\"content\":\"// SPDX-License-Identifier: MIT\\npragma solidity ^0.8.24;\\n\\nimport { IMatchData } from \\\"./IMatchData.sol\\\";\\nimport { IProofOfMatch } from \\\"./IProofOfMatch.sol\\\"; // Importamos el contrato, no una interfaz\\n\\n/**\\n * @title PresenceScore\\n * @author edsphinx\\n * @notice Read-only contract that calculates a \\\"Compliance Score\\\" for a user (e.g., a patient).\\n * @dev Serves as a Sybil resistance and on-chain reputation mechanism. It reads data from the\\n * ProofOfMatch (SBT registry) and MatchData (interaction data) contracts to generate a score\\n * based on a user's verified participation in scientific protocols.\\n */\\ncontract PresenceScore {\\n    /**\\n     * @notice The instance of the IProofOfMatch contract interface.\\n     */\\n    IProofOfMatch public proofOfMatchContract;\\n    /**\\n     * @notice The instance of the IMatchData contract interface.\\n     */\\n    IMatchData public matchDataContract;\\n\\n    /**\\n     * @dev On deployment, links the addresses of the contracts this scoring module depends on.\\n     */\\n    constructor(address _proofOfMatchAddress, address _matchDataAddress) {\\n        proofOfMatchContract = IProofOfMatch(_proofOfMatchAddress);\\n        matchDataContract = IMatchData(_matchDataAddress);\\n    }\\n\\n    /**\\n     * @notice Calculates the Compliance Score for a given user address.\\n     * @dev It fetches all of the user's \\\"Proof of Protocol\\\" SBTs, gets the details for each\\n     * associated interaction (including the compliance level), and applies a formula to generate the final score.\\n     * @param user The address of the user (e.g., patient) to query.\\n     * @return score The calculated Compliance Score.\\n     */\\n    function getPresenceScore(address user) public view returns (uint256) {\\n        uint256 score = 0;\\n\\n        uint256[] memory tokens = proofOfMatchContract.getTokensOfOwner(user);\\n\\n        for (uint i = 0; i < tokens.length; i++) {\\n            uint256 matchId = proofOfMatchContract.tokenToMatchId(tokens[i]);\\n\\n            IMatchData.Match memory currentMatch = matchDataContract.getMatchDetails(matchId);\\n\\n            if (currentMatch.level == 1) {\\n                score += 10;\\n            } else if (currentMatch.level == 2) {\\n                score += 25;\\n            } else if (currentMatch.level >= 3) {\\n                score += 50;\\n            }\\n        }\\n\\n        return score;\\n    }\\n}\\n\",\"keccak256\":\"0x800054634a6eaf2c1ad0631f25a09495fa4a63e4fd387404763819ec6125f6b6\",\"license\":\"MIT\"}},\"version\":1}",
  "bytecode": "0x608060405234801561001057600080fd5b5060405161068e38038061068e83398101604081905261002f9161007c565b600080546001600160a01b039384166001600160a01b031991821617909155600180549290931691161790556100af565b80516001600160a01b038116811461007757600080fd5b919050565b6000806040838503121561008f57600080fd5b61009883610060565b91506100a660208401610060565b90509250929050565b6105d0806100be6000396000f3fe608060405234801561001057600080fd5b50600436106100415760003560e01c80631a29a73a1461004657806347f6702c14610076578063d9c187f714610089575b600080fd5b600154610059906001600160a01b031681565b6040516001600160a01b0390911681526020015b60405180910390f35b600054610059906001600160a01b031681565b61009c6100973660046102bb565b6100aa565b60405190815260200161006d565b60008054604051635de6dc5560e01b81526001600160a01b03848116600483015283928392911690635de6dc5590602401600060405180830381865afa1580156100f8573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610120919081019061034f565b905060005b815181101561029a576000805483516001600160a01b039091169063fbd46dd190859085908110610158576101586103f5565b60200260200101516040518263ffffffff1660e01b815260040161017e91815260200190565b602060405180830381865afa15801561019b573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101bf919061040b565b6001546040516316fae89360e11b8152600481018390529192506000916001600160a01b0390911690632df5d12690602401600060405180830381865afa15801561020e573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610236919081019061044c565b9050806080015160ff1660010361025957610252600a86610573565b9450610290565b806080015160ff1660020361027357610252601986610573565b6003816080015160ff16106102905761028d603286610573565b94505b5050600101610125565b50909392505050565b6001600160a01b03811681146102b857600080fd5b50565b6000602082840312156102cd57600080fd5b81356102d8816102a3565b9392505050565b634e487b7160e01b600052604160045260246000fd5b60405160c0810167ffffffffffffffff81118282101715610318576103186102df565b60405290565b604051601f8201601f1916810167ffffffffffffffff81118282101715610347576103476102df565b604052919050565b6000602080838503121561036257600080fd5b825167ffffffffffffffff8082111561037a57600080fd5b818501915085601f83011261038e57600080fd5b8151818111156103a0576103a06102df565b8060051b91506103b184830161031e565b81815291830184019184810190888411156103cb57600080fd5b938501935b838510156103e9578451825293850193908501906103d0565b98975050505050505050565b634e487b7160e01b600052603260045260246000fd5b60006020828403121561041d57600080fd5b5051919050565b805160ff8116811461043557600080fd5b919050565b805161ffff8116811461043557600080fd5b6000602080838503121561045f57600080fd5b825167ffffffffffffffff8082111561047757600080fd5b9084019060c0828703121561048b57600080fd5b6104936102f5565b825161049e816102a3565b8152828401516104ad816102a3565b81850152604083810151908201526060830151828111156104cd57600080fd5b8301601f810188136104de57600080fd5b8051838111156104f0576104f06102df565b610502601f8201601f1916870161031e565b9350808452888682840101111561051857600080fd5b60005b8181101561053657828101870151858201880152860161051b565b506000868286010152505081606082015261055360808401610424565b608082015261056460a0840161043a565b60a08201529695505050505050565b8082018082111561059457634e487b7160e01b600052601160045260246000fd5b9291505056fea264697066735822122088d89acd5d2c9f1833afe1fbed347321c2b2f27bad6ccd8fd53948a99c93518664736f6c63430008180033",
  "deployedBytecode": "0x608060405234801561001057600080fd5b50600436106100415760003560e01c80631a29a73a1461004657806347f6702c14610076578063d9c187f714610089575b600080fd5b600154610059906001600160a01b031681565b6040516001600160a01b0390911681526020015b60405180910390f35b600054610059906001600160a01b031681565b61009c6100973660046102bb565b6100aa565b60405190815260200161006d565b60008054604051635de6dc5560e01b81526001600160a01b03848116600483015283928392911690635de6dc5590602401600060405180830381865afa1580156100f8573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610120919081019061034f565b905060005b815181101561029a576000805483516001600160a01b039091169063fbd46dd190859085908110610158576101586103f5565b60200260200101516040518263ffffffff1660e01b815260040161017e91815260200190565b602060405180830381865afa15801561019b573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101bf919061040b565b6001546040516316fae89360e11b8152600481018390529192506000916001600160a01b0390911690632df5d12690602401600060405180830381865afa15801561020e573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610236919081019061044c565b9050806080015160ff1660010361025957610252600a86610573565b9450610290565b806080015160ff1660020361027357610252601986610573565b6003816080015160ff16106102905761028d603286610573565b94505b5050600101610125565b50909392505050565b6001600160a01b03811681146102b857600080fd5b50565b6000602082840312156102cd57600080fd5b81356102d8816102a3565b9392505050565b634e487b7160e01b600052604160045260246000fd5b60405160c0810167ffffffffffffffff81118282101715610318576103186102df565b60405290565b604051601f8201601f1916810167ffffffffffffffff81118282101715610347576103476102df565b604052919050565b6000602080838503121561036257600080fd5b825167ffffffffffffffff8082111561037a57600080fd5b818501915085601f83011261038e57600080fd5b8151818111156103a0576103a06102df565b8060051b91506103b184830161031e565b81815291830184019184810190888411156103cb57600080fd5b938501935b838510156103e9578451825293850193908501906103d0565b98975050505050505050565b634e487b7160e01b600052603260045260246000fd5b60006020828403121561041d57600080fd5b5051919050565b805160ff8116811461043557600080fd5b919050565b805161ffff8116811461043557600080fd5b6000602080838503121561045f57600080fd5b825167ffffffffffffffff8082111561047757600080fd5b9084019060c0828703121561048b57600080fd5b6104936102f5565b825161049e816102a3565b8152828401516104ad816102a3565b81850152604083810151908201526060830151828111156104cd57600080fd5b8301601f810188136104de57600080fd5b8051838111156104f0576104f06102df565b610502601f8201601f1916870161031e565b9350808452888682840101111561051857600080fd5b60005b8181101561053657828101870151858201880152860161051b565b506000868286010152505081606082015261055360808401610424565b608082015261056460a0840161043a565b60a08201529695505050505050565b8082018082111561059457634e487b7160e01b600052601160045260246000fd5b9291505056fea264697066735822122088d89acd5d2c9f1833afe1fbed347321c2b2f27bad6ccd8fd53948a99c93518664736f6c63430008180033",
  "devdoc": {
    "author": "edsphinx",
    "details": "Serves as a Sybil resistance and on-chain reputation mechanism. It reads data from the ProofOfMatch (SBT registry) and MatchData (interaction data) contracts to generate a score based on a user's verified participation in scientific protocols.",
    "kind": "dev",
    "methods": {
      "constructor": {
        "details": "On deployment, links the addresses of the contracts this scoring module depends on."
      },
      "getPresenceScore(address)": {
        "details": "It fetches all of the user's \"Proof of Protocol\" SBTs, gets the details for each associated interaction (including the compliance level), and applies a formula to generate the final score.",
        "params": {
          "user": "The address of the user (e.g., patient) to query."
        },
        "returns": {
          "_0": "score The calculated Compliance Score."
        }
      }
    },
    "title": "PresenceScore",
    "version": 1
  },
  "userdoc": {
    "kind": "user",
    "methods": {
      "getPresenceScore(address)": {
        "notice": "Calculates the Compliance Score for a given user address."
      },
      "matchDataContract()": {
        "notice": "The instance of the IMatchData contract interface."
      },
      "proofOfMatchContract()": {
        "notice": "The instance of the IProofOfMatch contract interface."
      }
    },
    "notice": "Read-only contract that calculates a \"Compliance Score\" for a user (e.g., a patient).",
    "version": 1
  },
  "storageLayout": {
    "storage": [
      {
        "astId": 3683,
        "contract": "contracts/Sunny/PresenceScore.sol:PresenceScore",
        "label": "proofOfMatchContract",
        "offset": 0,
        "slot": "0",
        "type": "t_contract(IProofOfMatch)3500"
      },
      {
        "astId": 3687,
        "contract": "contracts/Sunny/PresenceScore.sol:PresenceScore",
        "label": "matchDataContract",
        "offset": 0,
        "slot": "1",
        "type": "t_contract(IMatchData)3466"
      }
    ],
    "types": {
      "t_contract(IMatchData)3466": {
        "encoding": "inplace",
        "label": "contract IMatchData",
        "numberOfBytes": "20"
      },
      "t_contract(IProofOfMatch)3500": {
        "encoding": "inplace",
        "label": "contract IProofOfMatch",
        "numberOfBytes": "20"
      }
    }
  }
}